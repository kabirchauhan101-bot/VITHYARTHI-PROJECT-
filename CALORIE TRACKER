import json
import os
DATA_FILE = "food_log.json"
def load_meal_history():
    """
    If the file:
      - doesn't exist,
      - is empty,
      - or is corrupted,
    Returns:
        list: A list of meal dictionaries. Or [] if nothing could be loaded.
    """
    if not os.path.exists(DATA_FILE):
        print("Heads up: No logbook found — starting fresh")
        return []
    try:
        with open(DATA_FILE, "r") as f:
            logbook = json.load(f)
            if isinstance(logbook, list):
                return logbook
            print("Starting fresh!")
            return []
    except json.JSONDecodeError:
        print("Starting a clean one!")
        return []
    except Exception as e:
        print(f"Unexpected error reading the logbook: {e}")
        return []
def save_meal_history(entries):
    """
        entries (list): All meal entry dictionaries.
    Returns:
        bool: True if saved successfully, False otherwise.
    """
    try:
        with open(DATA_FILE, "w") as f:
            json.dump(entries, f, indent=2)
        return True
    except Exception as e:
        print(f" Could not save the logbook! Error: {e}")
        return False
def display_daily_summary(entries):
    """
        entries (list): All logged meal dictionaries.
    """
    print(+ "=" * 50)
    print("DAILY LOG SUMMARY")
    print("=" * 50)
    if not entries:
        print("Your log is empty today! Time to enjoy something tasty ")
        print("=" * 50 + ")
        return
    total_calories = sum(entry["calories"] for entry in entries)
    total_grams = sum(entry["grams"] for entry in entries)
    print(f"Meals Logged:   {len(entries)}")
    print(f"Total Calories: {total_calories:.1 f} kcal")
    print(f"Total Weight:   {total_grams:.1 f} g")
    print("=" * 50 + "\n")
def get_a_safe_number(prompt, input_type=float):
    """
        prompt (str): Prompt text.
        input_type (type): float or int.
    Returns:
        number or None (if user types 'cancel')
    """
    while True:
        user_input = input(prompt).strip()
        if user_input.lower() == "cancel":
            return None
        try:
            value = input_type(user_input)
            if value < 0:
                print("We only log *positive* numbers. Try again")
                continue
            return value
        except Value error:
            print("That doesn't look like a number! Try something like 150.5")
            continue
def log_a_new_meal(entries):
    """
    Args:
        entries (list): Existing list of entries.
    Returns:
        bool: True if logging succeeded, False is cancelled.
    """
    print("Logging a New Meal")
    print("(Type 'cancel' anytime to return to menu.)")
    food_name = input("What did you eat?").strip()
    if not food_name or food_name.lower() == "cancel":
        print("Cancelled — back to the menu!")
        return False
    calories = get_a_safe_number("Calories (kcal): ")
    if calories are None:
        print("Cancelled — back to the menu!")
        return False
    grams = get_a_safe_number("Weight (g):")
    if grams are None:
        print("back to the menu!")
        return False
    new_entry = {"name": food_name,
        "calories": calories,
        "grams": grams}
    entries.append(new_entry)
    if save_meal_history(entriesries):
        print(f" Logged successfully: {food_name} "
              f"({calories} kcal, {grams} g)")
        return True
    else:
        entries.pop()
        print(" Save failed! Meal not recorded.")
        return False
def main():
    ""
    print(" + "═" * 50")
    print("WELCOME TO CALORIE TRACKER")
    print("═" * 50)
    entries = load_meal_history()
    display_daily_summary(entries)
    while True:
        print("What would you like to do?")
        print(" Log a new meal")
        print(" View summary again")
        print(" Type 'exit' to quit")
        choice = input("\nYour choice: ").strip().lower()
        if choice == "exit":
            print(" Goodbye! Stay healthy and happy!")
            break
        elif choice == "1":
            log_a_new_meal(entries)
        elif choice == "2":
            display_daily_summary(entries)
        else:
            print("\nI didn't understand that  Try again.")
if __name__ == "__main__":
    main()
